<!-- TODO: 각 블록 아래에 그날 카테고리별 총 시간 계산해서 표시 -->
<!-- TODO: 경계값. 22:49~01:30 같은 자정 넘어가는 타임블록 처리 -->

<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Weekly Timeline</title>
<style>

body {
  font-family: Arial;
  display: flex;
  flex-direction: column;
  align-items: center;
  margin: 0;
  padding: 20px;
}

h2 { margin-bottom: 20px; }

.week-container {
  display: flex;
  gap: 20px; /* 요일 간격 */
  overflow-x: auto; /* 화면이 좁으면 좌우 스크롤 */
}

.day-column {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin: 0 5px;
}

.day-label {
  margin-bottom: 10px;
}

.timeline {
  display: grid;
  grid-template-columns: 25px repeat(6, 25px); /* 절반 크기로 변경 */
  gap: 1px;
  margin-bottom: 20px;
}

.hour {
  text-align: right;
  padding-right: 3px; /* 절반 크기에 맞게 padding 줄임 */
  font-size: 10px;    /* 숫자도 조금 줄이는 게 보기 좋음 */
}

.block {
  width: 25px;   /* 절반 크기 */
  height: 15px;  /* 절반 크기 */
  background-color: #eee;
  position: relative;
  cursor: pointer;
}

.daily { background-color: #ADD8E6; }
.focus { background-color: #7EC850; }
.productive { background-color: #20B2AA; }
.mind { background-color: #b1b1df; }
.waste { background-color: #F07C7C; }
.schedule { background-color: #788dca; }
.other { background-color: #acacac; }

.tooltip {
  visibility: hidden;
  background: rgb(56, 73, 111);
  color: #fff;
  padding: 2px 4px;
  border-radius: 3px;
  position: absolute;
  top: -20px;
  left: 0;
  white-space: nowrap;
  font-size: 12px;
  z-index: 999;
}

.block:hover .tooltip { visibility: visible; }

.block-text-area {
  margin-top: 5px;
  width: 100%;       /* 부모 컬럼 너비에 맞춤 */
  min-height: 20px;  
  text-align: center;
  font-size: 12px;
  color: black;
  word-break: break-word; /* 단어가 길어도 줄바꿈 */
  white-space: pre-wrap;
}

.block-text-area.daily { background-color: #ADD8E6; }
.block-text-area.focus { background-color: #7EC850; }
.block-text-area.productive { background-color: #20B2AA; }
.block-text-area.mind { background-color: #b1b1df; }
.block-text-area.waste { background-color: #F07C7C; }
.block-text-area.schedule { background-color: #788dca; }
.block-text-area.other { background-color: #acacac; }


</style>
</head>
<body>

<h3>Weekly Timeline</h3>
<input type="date" id="datePicker" />
<br>
<div class="week-container" id="weekContainer"></div>

<script>
const data = [
  {date:"2025-09-02", start:"7:30", end:"8:00", type:"daily", desc:"샤워"},
  {date:"2025-09-02", start:"8:00", end:"9:00", type:"daily", desc:"아침식사"},
  {date:"2025-09-02", start:"9:00", end:"11:00", type:"focus", desc:"2025 논술형 문제 공부"},
  {date:"2025-09-02", start:"11:28", end:"12:09", type:"focus", desc:"2024 기출 공부"},
  {date:"2025-09-03", start:"09:00", end:"09:30", type:"daily", desc:"기상"},
  {date:"2025-09-03", start:"09:30", end:"10:00", type:"focus", desc:"공부 시작"},
  {date:"2025-09-03", start:"10:00", end:"11:00", type:"productive", desc:"개인 프로젝트 작업"}
];

const categoryNameMap = {
    'daily': '일상',
    'schedule': '일정',
    'focus': '집중',
    'productive': '생산',
    'mind': '마음',
    'waste': '낭비',
    'sleep': '수면'
};

function timeToIndex(time) {
  const [h, m] = time.split(":").map(Number);
  return h * 6 + Math.floor(m / 10);
}

// 주 시작(월요일) 계산 함수
function getMonday(d) {
  const date = new Date(d);
  const day = date.getDay(); // 0=일, 1=월, ...
  const diff = (day === 0 ? -6 : 1) - day; // 월요일까지 이동
  date.setDate(date.getDate() + diff);
  date.setHours(0,0,0,0);
  return date;
}

function renderDay(dateStr, label) {
  const container = document.createElement("div");
  container.className = "day-column";

  // 요일 라벨
  const dayLabel = document.createElement("div");
  dayLabel.className = "day-label";
  dayLabel.textContent = label;
  container.appendChild(dayLabel);

  // 타임라인
  const timelineEl = document.createElement("div");
  timelineEl.className = "timeline";
  container.appendChild(timelineEl);

  const filteredData = data.filter(d => d.date === dateStr);

  // 블록 생성
  for (let hour = 5; hour <= 28; hour++) {
    const hourEl = document.createElement("div");
    hourEl.className = "hour";
    
    // 24시 이상일 때는 24 빼서 다음날 시간으로 표시
    const displayHour = hour >= 24 ? hour - 24 : hour;
    hourEl.textContent = displayHour
    // hourEl.textContent = hour;
    
    timelineEl.appendChild(hourEl);

    for (let i = 0; i < 6; i++) {
      const block = document.createElement("div");
      block.className = "block";
      const blockIndex = hour * 6 + i;

      filteredData.forEach(d => {
        const startIndex = timeToIndex(d.start);
        const endIndex = timeToIndex(d.end);
        if (blockIndex >= startIndex && blockIndex < endIndex) {
          block.className = "block " + d.type;

          // 툴팁
          const tooltip = document.createElement("span");
          tooltip.className = "tooltip";
          tooltip.textContent = `${d.start}~${d.end}` + d.desc;
          block.appendChild(tooltip);

          // 블록 아래 영역에 표시할 텍스트 이벤트
          block.addEventListener("mouseenter", () => {
            textArea.textContent = `${d.start}~${d.end}\n` + d.desc;
            // 블록 클래스에 맞춰 텍스트 배경색 적용
            textArea.className = "block-text-area " + d.type; 
          });
          block.addEventListener("mouseleave", () => {
            textArea.textContent = "";
            textArea.className = "block-text-area"; // 배경색 초기화

          });
        }
      });

      timelineEl.appendChild(block);
    }
  }

  // 블록 아래에 표시할 영역
  const textArea = document.createElement("div");
  textArea.className = "block-text-area";
  container.appendChild(textArea);

  return container;
}

function renderWeek(baseDate) {
  const weekContainer = document.getElementById("weekContainer");
  weekContainer.innerHTML = "";

  const monday = getMonday(baseDate);
  const labels = ["월", "화", "수", "목", "금", "토", "일"];

  for (let i = 0; i < 7; i++) {
    const date = new Date(monday);
    date.setDate(monday.getDate() + i);
    const dateStr = `${date.getFullYear()}-${(date.getMonth()+1).toString().padStart(2,'0')}-${date.getDate().toString().padStart(2,'0')}`;


    const month = date.getMonth() + 1;
    const day = date.getDate();
    const labelWithDate = `${month}/${day} ${labels[i]}`;

    const dayCol = renderDay(dateStr, labelWithDate);
    weekContainer.appendChild(dayCol);
  }

  // datePicker 값 동기화 (주중 아무 날이나 기준)
  document.getElementById("datePicker").value = baseDate.toISOString().slice(0,10);
}


// ---------------------- 이벤트 ----------------------

// 날짜 선택 → 해당 주 렌더링
document.getElementById("datePicker").addEventListener("change", (e) => {
  const selectedDate = new Date(e.target.value);
  renderWeek(selectedDate);
});

// 키보드 좌우 화살표로 주 이동
document.addEventListener("keydown", (e) => {
  const currentDate = new Date(document.getElementById("datePicker").value);
  if (e.key === "ArrowLeft") {
    currentDate.setDate(currentDate.getDate() - 7); // 이전 주
    renderWeek(currentDate);
  } else if (e.key === "ArrowRight") {
    currentDate.setDate(currentDate.getDate() + 7); // 다음 주
    renderWeek(currentDate);
  }
});

// ---------------------- 초기 실행 ----------------------
const today = new Date();
renderWeek(today);
</script>
</body>
</html>
